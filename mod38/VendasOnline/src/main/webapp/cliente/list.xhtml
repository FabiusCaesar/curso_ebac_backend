<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

<f:view>
  <h:head>
    <title>Clientes</title>
    <h:outputStylesheet>
      .page {
        max-width: 1000px;
        margin: 0 auto;
        padding: 1.5rem 1rem 3rem;
      }
      .title {
        margin: 1rem 0 1rem;
        text-align: center;
        font-family: inherit !important; /* mesma fonte do tema */
      }

      /* ==== Barra de busca ==== */
      .searchbar {
        max-width: 900px;
        margin: 0 auto 1rem;
        display: flex;
        gap: .5rem;
        align-items: center;
        justify-content: center;
        flex-wrap: wrap;
      }

      /* ==== Ações do formulário ==== */
      .actions {
        display: flex;
        gap: .75rem;
        flex-wrap: wrap;
        justify-content: center;
        margin-top: .5rem;
      }

      /* ==== Ações por linha na tabela ==== */
      .table-actions {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: .5rem;
        flex-wrap: wrap;
      }
      .table-actions .p-button.p-button-rounded {
        width: 2.25rem;
        height: 2.25rem;
        padding: 0;
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }

      /* ==== FORMULÁRIO ==== */
      .form-container {
        max-width: 900px;
        margin: 0 auto;            /* centraliza o bloco label+input */
        text-align: center;
      }
      #formCliente .ui-panelgrid-blank .ui-panelgrid-cell { border: 0 !important; }
      #formCliente .ui-panelgrid-cell { padding: 8px 0; }

      /* grid “encolhido” ao conteúdo e centralizado */
      #formCliente .centered-grid {
        display: inline-table;
        margin: 0 auto;
        text-align: left;
      }

      /* duas colunas: label à direita, perto do input */
      #formCliente .label-col {
        text-align: right;
        white-space: nowrap;
        width: 170px;
        padding-right: 10px;        /* aproxima label do input */
        vertical-align: middle;
      }
      #formCliente .field-col { width: auto; }

      /* larguras dos campos */
      #formCliente input[type="text"].w-xs { width: 160px; max-width: 100%; } /* estado, cep */
      #formCliente input[type="text"].w-sm { width: 220px; max-width: 100%; } /* cpf, tel, número */
      #formCliente input[type="text"].w-md { width: 420px; max-width: 100%; } /* cidade */
      #formCliente input[type="text"].w-lg { width: 640px; max-width: 100%; } /* nome, endereço */

      /* p:inputNumber (Número): largura “sm” */
      #formCliente .ui-inputnumber.w-sm { width: 220px; max-width: 100%; display: inline-block; }
      #formCliente .ui-inputnumber.w-sm input { width: 100%; }

      /* TABELA centralizada e mais estreita que a página */
      .table-wrap { max-width: 1000px; margin: 0 auto; }
    </h:outputStylesheet>
  </h:head>

  <h:body>
    <!-- Menubar -->
    <h:form id="menuForm">
      <ui:include src="/WEB-INF/includes/menubar.xhtml" />
    </h:form>

    <div class="page">
      <p:growl id="growl" showDetail="true" life="3000" />

      <!-- ===== BUSCA POR CPF ===== -->
      <h:panelGroup layout="block" styleClass="ui-widget">
        <h2 class="title">Buscar Cliente</h2>
      </h:panelGroup>

      <h:form id="buscaCliente">
        <div class="searchbar">
          <p:inputMask id="cpfBusca"
                       mask="999.999.999-99"
                       value="#{clienteController.cpfBuscaMask}"
                       placeholder="CPF do cliente" />
          <p:commandButton value="Buscar" icon="pi pi-search"
                           actionListener="#{clienteController.buscarPorCPF}"
                           process="@this cpfBusca"
                           update=":formCliente :growl" />
        </div>
      </h:form>

      <!-- ===== FORMULÁRIO ===== -->
      <h:panelGroup layout="block" styleClass="ui-widget">
        <h2 class="title">#{clienteController.update ? 'Atualizar Cliente' : 'Novo Cliente'}</h2>
      </h:panelGroup>

      <h:form id="formCliente">
        <div class="form-container">
          <p:panel header="Dados do Cliente" toggleable="true" collapsed="false" toggleSpeed="150">
            <p:panelGrid columns="2" layout="tabular"
                         styleClass="ui-panelgrid-blank centered-grid"
                         columnClasses="label-col,field-col">

              <p:outputLabel for="nome" value="Nome" />
              <p:inputText id="nome" value="#{clienteController.cliente.nome}"
                           required="true" maxlength="50" styleClass="w-lg" />

              <p:outputLabel for="cpf" value="CPF" />
              <p:inputMask id="cpf" mask="999.999.999-99"
                           value="#{clienteController.cpfMask}"
                           required="true" styleClass="w-sm" />

              <p:outputLabel for="tel" value="Telefone" />
              <p:inputMask id="tel" mask="(99) 99999-9999"
                           value="#{clienteController.telMask}"
                           required="true" styleClass="w-sm" />

              <p:outputLabel for="cep" value="CEP" />
              <p:inputMask id="cep" mask="99999-999"
                           value="#{clienteController.cliente.cep}"
                           required="true" styleClass="w-xs" />

              <p:outputLabel for="end" value="Endereço" />
              <p:inputText id="end" value="#{clienteController.cliente.end}"
                           required="true" maxlength="50" styleClass="w-lg" />

              <p:outputLabel for="numero" value="Número" />
              <p:inputNumber id="numero" value="#{clienteController.cliente.numero}"
                             required="true" decimalPlaces="0"
                             styleClass="w-sm" />

              <p:outputLabel for="cidade" value="Cidade" />
              <p:inputText id="cidade" value="#{clienteController.cliente.cidade}"
                           required="true" maxlength="50" styleClass="w-md" />

              <p:outputLabel for="estado" value="Estado" />
              <p:inputText id="estado" value="#{clienteController.cliente.estado}"
                           required="true" maxlength="50" styleClass="w-xs" />

            </p:panelGrid>

            <div class="actions">
              <p:commandButton value="Cadastrar"
                               actionListener="#{clienteController.add}"
                               update="formCliente tabela growl"
                               rendered="#{!clienteController.update}" icon="pi pi-check" />

              <p:commandButton value="Atualizar"
                               actionListener="#{clienteController.update}"
                               update="formCliente tabela growl"
                               rendered="#{clienteController.update}" icon="pi pi-save" />

              <p:commandButton value="Cancelar"
                               actionListener="#{clienteController.cancel}"
                               process="@this" immediate="true"
                               resetValues="true"
                               update="formCliente"
                               styleClass="p-button-secondary" icon="pi pi-times" />
            </div>
          </p:panel>
        </div>
      </h:form>

      <!-- ===== LISTA ===== -->
      <h:panelGroup layout="block" styleClass="ui-widget">
        <h2 class="title">Clientes Cadastrados</h2>
      </h:panelGroup>

      <div class="table-wrap">
        <h:form id="tabela">
          <p:dataTable value="#{clienteController.clientes}" var="c" paginator="true" rows="10"
                       responsiveLayout="scroll" emptyMessage="Nenhum cliente encontrado."
                       style="max-width:1000px; margin:0 auto; display:block">

            <p:column headerText="ID"
                      headerStyle="text-align:center"
                      style="width:80px; text-align:center">
              <h:outputText value="#{c.id}" />
            </p:column>

            <p:column headerText="Nome"
                      headerStyle="text-align:center"
                      style="text-align:center">
              <h:outputText value="#{c.nome}" />
            </p:column>

            <p:column headerText="CPF"
                      headerStyle="text-align:center"
                      style="text-align:center">
              <!-- mostra com máscara se quiser; senão, apenas #{c.cpf} -->
              <h:outputText value="#{clienteController.formatCpf(c.cpf)}" />
            </p:column>

            <p:column headerText="Telefone"
                      headerStyle="text-align:center"
                      style="text-align:center">
              <h:outputText value="#{clienteController.formatTel(c.tel)}" />
            </p:column>

            <p:column headerText="Cidade"
                      headerStyle="text-align:center"
                      style="text-align:center">
              <h:outputText value="#{c.cidade}" />
            </p:column>

            <p:column headerText="Estado"
                      headerStyle="text-align:center"
                      style="text-align:center">
              <h:outputText value="#{c.estado}" />
            </p:column>

            <p:column headerText="Ações"
                      headerStyle="text-align:center"
                      style="text-align:center; width:160px">
              <div class="table-actions">
                <p:commandButton id="btnEditar"
                                 icon="pi pi-pencil" title="Editar"
                                 actionListener="#{clienteController.edit(c)}"
                                 update=":formCliente :growl"
                                 styleClass="p-button-rounded p-button-info ui-button-info" />

                <p:commandButton id="btnExcluir"
                                 icon="pi pi-trash" title="Excluir"
                                 actionListener="#{clienteController.delete(c)}"
                                 update="tabela :growl" process="@this"
                                 styleClass="p-button-rounded ui-button-danger">
                  <p:confirm header="Confirmação"
                             message="Deseja excluir este cliente?"
                             icon="pi pi-exclamation-triangle" />
                </p:commandButton>
              </div>

              <p:tooltip for="btnEditar" value="Editar" />
              <p:tooltip for="btnExcluir" value="Excluir" />
            </p:column>

          </p:dataTable>

          <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
            <p:commandButton value="Sim" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check" />
            <p:commandButton value="Não" type="button" styleClass="ui-confirmdialog-no ui-button-flat" icon="pi pi-times" />
          </p:confirmDialog>
        </h:form>
      </div>
    </div>
  </h:body>
</f:view>
</html>
