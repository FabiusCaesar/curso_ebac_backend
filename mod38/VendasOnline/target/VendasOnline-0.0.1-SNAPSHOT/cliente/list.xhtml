<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

<f:view>
  <h:head>
    <title>Clientes</title>
    <h:outputStylesheet>
      .page {
        max-width: 1000px;
        margin: 0 auto;
        padding: 1.5rem 1rem 3rem;
      }
      .title {
        margin: 1rem 0 1rem;
        text-align: center;
      }
      .actions {
        display: flex;
        gap: .75rem;
        flex-wrap: wrap;
        justify-content: center;
        margin-top: .5rem;
      }
    </h:outputStylesheet>
  </h:head>

  <h:body>
    <!-- Menubar -->
    <h:form id="menuForm">
      <ui:include src="/WEB-INF/includes/menubar.xhtml"/>
    </h:form>

    <div class="page">
      <p:growl id="growl" showDetail="true" life="3000"/>

      <!-- Formulário (primeiro) -->
      <h2 class="title">#{clienteController.update ? 'Atualizar Cliente' : 'Novo Cliente'}</h2>
      <h:form id="formCliente">
        <p:panel header="Dados do Cliente"  toggleable="true" collapsed="false" toggleSpeed="150">
          <p:panelGrid columns="2" layout="grid" styleClass="p-fluid">

            <p:outputLabel for="nome" value="Nome"/>
            <p:inputText id="nome" value="#{clienteController.cliente.nome}" required="true" maxlength="50"/>

            <p:outputLabel for="cpf" value="CPF"/>
            <p:inputMask id="cpf" mask="999.999.999-99" validateMask="true"
                         value="#{clienteController.cpfMask}" required="true"/>

            <p:outputLabel for="tel" value="Telefone"/>
            <p:inputMask id="tel" mask="(99) 99999-9999" validateMask="true"
                         value="#{clienteController.telMask}" required="true"/>

            <p:outputLabel for="cep" value="CEP"/>
            <p:inputMask id="cep" mask="99999-999" validateMask="true"
                         value="#{clienteController.cliente.cep}" required="true"/>

            <p:outputLabel for="end" value="Endereço"/>
            <p:inputText id="end" value="#{clienteController.cliente.end}" required="true" maxlength="50"/>

            <p:outputLabel for="numero" value="Número"/>
            <p:inputText id="numero" value="#{clienteController.cliente.numero}" required="true">
              <p:keyFilter mask="num"/>
            </p:inputText>

            <p:outputLabel for="cidade" value="Cidade"/>
            <p:inputText id="cidade" value="#{clienteController.cliente.cidade}" required="true" maxlength="50"/>

            <p:outputLabel for="estado" value="Estado"/>
            <p:inputText id="estado" value="#{clienteController.cliente.estado}" required="true" maxlength="50"/>
          </p:panelGrid>

          <div class="actions">
            <p:commandButton value="Cadastrar" icon="pi pi-check"
                             actionListener="#{clienteController.add}"
                             update="formCliente tabela growl"
                             rendered="#{!clienteController.update}"/>

            <p:commandButton value="Atualizar" icon="pi pi-save"
                             actionListener="#{clienteController.update}"
                             update="formCliente tabela growl"
                             rendered="#{clienteController.update}"/>

            <p:commandButton value="Cancelar" icon="pi pi-times"
                             actionListener="#{clienteController.cancel}"
                             update="formCliente" immediate="true"
                             styleClass="p-button-secondary"/>

            <p:commandButton value="Voltar" icon="pi pi-arrow-left"
                             action="#{clienteController.voltarTelaInicial()}"
                             ajax="false" styleClass="p-button-outlined"/>
          </div>
        </p:panel>
      </h:form>

      <!-- Lista (depois) -->
      <h2 class="title">Clientes Cadastrados</h2>
      <h:form id="tabela">
        <p:dataTable value="#{clienteController.clientes}" var="c" paginator="true" rows="10"
                     responsiveLayout="scroll" emptyMessage="Nenhum cliente encontrado.">

          <p:column headerText="ID" style="width:80px;text-align:center">
            <h:outputText value="#{c.id}"/>
          </p:column>

          <p:column headerText="Nome">
            <h:outputText value="#{c.nome}"/>
          </p:column>

          <p:column headerText="CPF">
            <h:outputText value="#{c.cpf}"/>
          </p:column>

          <p:column headerText="Telefone">
            <h:outputText value="#{c.tel}"/>
          </p:column>

          <p:column headerText="Cidade">
            <h:outputText value="#{c.cidade}"/>
          </p:column>

          <p:column headerText="Estado">
            <h:outputText value="#{c.estado}"/>
          </p:column>

          <p:column headerText="Ações" style="text-align:center; width:160px">
            <p:commandButton icon="pi pi-pencil" title="Editar"
                             actionListener="#{clienteController.edit(c)}"
                             update=":formCliente :growl"
                             styleClass="p-button-rounded p-button-warning"/>
            <p:commandButton icon="pi pi-trash" title="Excluir"
                             actionListener="#{clienteController.delete(c)}"
                             update="tabela :growl" process="@this"
                             styleClass="p-button-rounded p-button-danger">
              <p:confirm header="Confirmação"
                         message="Deseja excluir este cliente?"
                         icon="pi pi-exclamation-triangle"/>
            </p:commandButton>
          </p:column>
        </p:dataTable>

        <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
          <p:commandButton value="Sim" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check"/>
          <p:commandButton value="Não" type="button" styleClass="ui-confirmdialog-no ui-button-flat" icon="pi pi-times"/>
        </p:confirmDialog>
      </h:form>
    </div>
  </h:body>
</f:view>
</html>
